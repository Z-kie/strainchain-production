        // Sample NFT data for demonstration
        const sampleNFTs = [
            {
                id: 'vintage_001',
                name: 'Maui Wowie Classic',
                era: '1970s',
                price: 5.0,
                type: 'static',
                image: 'üå∫',
                description: '1974 Hawaiian packaging - Psychedelic rainbow design',
                rarity: 'legendary',
                sold: false,
                views: 1247,
                likes: 89
            },
            {
                id: 'vintage_002', 
                name: 'Underground Kush',
                era: '1980s',
                price: 3.5,
                type: 'animated',
                image: 'üé®',
                description: '1982 California street art style packaging',
                rarity: 'rare',
                sold: false,
                views: 892,
                likes: 67
            },
            {
                id: 'vintage_003',
                name: 'Medical Mint',
                era: '2000s',
                price: 2.0,
                type: 'static',
                image: 'üè•',
                description: '2003 Early medical cannabis professional design',
                rarity: 'uncommon',
                sold: true,
                views: 543,
                likes: 34
            },
            {
                id: 'vintage_004',
                name: 'Northern Lights Heritage',
                era: '1990s',
                price: 15.0,
                type: 'interactive',
                image: 'üåå',
                description: '1995 Legendary strain packaging with grow info',
                rarity: 'legendary',
                sold: false,
                views: 2103,
                likes: 156
            },
            {
                id: 'vintage_005',
                name: 'OG Kush Original',
                era: '1990s',
                price: 25.0,
                type: 'commercial',
                image: 'üëë',
                description: 'Original OG Kush packaging - Full commercial rights',
                rarity: 'mythic',
                sold: false,
                views: <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StrainChain - Cannabis Authentication</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0d1421 0%, #1a2332 50%, #2d4a3e 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
        }

        .container {
            max-width: 100vw;
            margin: 0;
            background: rgba(255, 255, 255, 0.02);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #00d4aa 0%, #4ade80 100%);
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .premium-badge {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #1a1a1a;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .user-stats {
            display: flex;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.2);
            padding: 10px 20px;
            font-size: 12px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-weight: bold;
            color: #00d4aa;
        }

        .nav-tabs {
            display: flex;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            overflow-x: auto;
        }

        .nav-tab {
            flex: 1;
            min-width: 80px;
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            position: relative;
            white-space: nowrap;
        }

        .nav-tab.active {
            color: #00d4aa;
            background: rgba(0, 212, 170, 0.1);
        }

        .nav-tab.premium {
            background: linear-gradient(45deg, rgba(255, 215, 0, 0.1), rgba(255, 237, 78, 0.1));
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .tab-content {
            display: none;
            padding: 15px;
            min-height: calc(100vh - 200px);
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .upgrade-banner {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #1a1a1a;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 12px;
            text-align: center;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .upgrade-banner:hover {
            transform: translateY(-2px);
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .feature-locked {
            opacity: 0.6;
            background: rgba(255, 255, 255, 0.02);
        }

        .premium-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .lock-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #00d4aa;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            font-size: 14px;
        }

        .form-input:focus {
            outline: none;
            border-color: #00d4aa;
            box-shadow: 0 0 0 2px rgba(0, 212, 170, 0.1);
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00d4aa 0%, #4ade80 100%);
            color: white;
        }

        .btn-premium {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #1a1a1a;
            font-weight: bold;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .pricing-card {
            background: linear-gradient(135deg, rgba(0, 212, 170, 0.1), rgba(74, 222, 128, 0.1));
            border: 2px solid #00d4aa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            text-align: center;
        }

        .pricing-card.featured {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 237, 78, 0.1));
            border-color: #ffd700;
            transform: scale(1.02);
        }

        .price {
            font-size: 32px;
            font-weight: bold;
            color: #00d4aa;
            margin-bottom: 10px;
        }

        .price.premium {
            color: #ffd700;
        }

        .price-period {
            font-size: 14px;
            opacity: 0.8;
        }

        .features-list {
            list-style: none;
            padding: 0;
            margin: 15px 0;
        }

        .features-list li {
            padding: 5px 0;
            font-size: 14px;
        }

        .features-list li::before {
            content: '‚úì';
            color: #00d4aa;
            margin-right: 8px;
            font-weight: bold;
        }

        .subscription-status {
            background: rgba(0, 212, 170, 0.1);
            border: 1px solid #00d4aa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }

        .verification-result {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
        }

        .verified {
            background: rgba(74, 222, 128, 0.2);
            color: #4ade80;
            border: 1px solid #4ade80;
        }

        .counterfeit {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid #ef4444;
        }

        .qr-scanner {
            text-align: center;
            padding: 20px;
        }

        .qr-placeholder {
            width: 150px;
            height: 150px;
            margin: 0 auto 15px;
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.02);
        }

        .earnings-display {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 237, 78, 0.1));
            border: 1px solid #ffd700;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-bottom: 15px;
        }

        .earnings-amount {
            font-size: 28px;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 5px;
        }

        .referral-code {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 16px;
            letter-spacing: 2px;
            text-align: center;
            margin: 10px 0;
        }

        .success-message, .error-message {
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 15px;
            display: none;
        }

        .success-message {
            background: rgba(74, 222, 128, 0.1);
            color: #4ade80;
            border: 1px solid #4ade80;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            border: 1px solid #ef4444;
        }

        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }

        .spinner {
            width: 30px;
            height: 30px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-top: 2px solid #00d4aa;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .business-cta {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 15px;
        }

        @media (max-width: 360px) {
            .nav-tab {
                font-size: 11px;
                padding: 10px 6px;
            }
            
            .pricing-card {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                üåø StrainChain
                <span class="premium-badge" id="userBadge" style="display: none;">PRO</span>
            </div>
            <div class="tagline">Cannabis Authentication on TON</div>
        </div>

        <div class="user-stats">
            <div class="stat-item">
                <div class="stat-value" id="userLevel">FREE</div>
                <div>Plan</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="verificationCount">0</div>
                <div>Verified</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="earningsCount">0.00</div>
                <div>TON Earned</div>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('verify')">Verify</button>
            <button class="nav-tab" onclick="switchTab('mint')">Mint</button>
            <button class="nav-tab premium" onclick="switchTab('premium')">Premium</button>
            <button class="nav-tab" onclick="switchTab('earn')">Earn</button>
            <button class="nav-tab" onclick="switchTab('business')">Business</button>
            <button class="nav-tab premium" onclick="switchTab('gallery')">üé® Art Gallery</button>
        </div>

        <!-- Verify Tab -->
        <div id="verify" class="tab-content active">
            <div class="success-message" id="verifySuccess"></div>
            <div class="error-message" id="verifyError"></div>

            <!-- Free users get limited verifications -->
            <div id="freeUserLimit" class="upgrade-banner" onclick="switchTab('premium')" style="display: none;">
                ‚ö†Ô∏è Free plan: 3 verifications remaining. Upgrade for unlimited!
            </div>

            <div class="qr-scanner">
                <div class="qr-placeholder" id="qrPlaceholder">üì±</div>
                <p>Scan QR code on cannabis package</p>
                <button class="btn btn-primary" onclick="simulateQRScan()">
                    Simulate QR Scan
                </button>
            </div>

            <div class="form-group">
                <label class="form-label">Or Enter Verification Code</label>
                <input type="text" class="form-input" id="verificationCode" placeholder="STRAIN-ABC123">
                <button class="btn btn-secondary" onclick="verifyStrain()" style="margin-top: 10px;">
                    Verify Strain
                </button>
            </div>

            <div id="verificationResult" style="display: none;">
                <div class="verification-result verified">
                    <h3>‚úÖ AUTHENTIC STRAIN VERIFIED</h3>
                    <div class="feature-card">
                        <h4 id="verifiedStrainName">Purple Haze</h4>
                        <p><strong>Genetics:</strong> <span id="verifiedGenetics">Sativa Dominant</span></p>
                        <p><strong>THC:</strong> <span id="verifiedTHC">24.5%</span> | <strong>CBD:</strong> <span id="verifiedCBD">1.2%</span></p>
                        <p><strong>Cultivator:</strong> <span id="verifiedCultivator">Green Valley Farms</span></p>
                        <p><strong>Lab:</strong> <span id="verifiedLab">GreenTech Labs</span></p>
                        <p><strong>Test Date:</strong> <span id="testDate">Dec 15, 2024</span></p>
                    </div>
                    
                    <!-- Premium feature teaser -->
                    <div class="feature-card feature-locked" id="premiumAnalysis">
                        <div class="premium-overlay">
                            <div class="lock-icon">üîí</div>
                            <p>Advanced Lab Analysis</p>
                            <button class="btn btn-premium" onclick="switchTab('premium')">Upgrade to Premium</button>
                        </div>
                        <h4>Detailed Terpene Profile</h4>
                        <p>Myrcene: 0.8% | Limonene: 0.6% | Pinene: 0.4%</p>
                        <p>Effects prediction, similar strains, and market pricing</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mint Tab -->
        <div id="mint" class="tab-content">
            <div class="success-message" id="mintSuccess"></div>
            <div class="error-message" id="mintError"></div>

            <!-- Business account required notice -->
            <div class="business-cta" id="businessRequired">
                <h3>üè¢ Business Account Required</h3>
                <p>NFT minting is available for licensed cannabis businesses only</p>
                <button class="btn btn-premium" onclick="switchTab('business')">
                    Upgrade to Business Account
                </button>
            </div>

            <div id="mintForm" style="display: none;">
                <form id="strainMintForm">
                    <div class="form-group">
                        <label class="form-label">Strain Name</label>
                        <input type="text" class="form-input" id="strainName" placeholder="e.g., Purple Haze" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Genetics</label>
                        <input type="text" class="form-input" id="genetics" placeholder="e.g., Sativa Dominant Hybrid">
                    </div>

                    <div class="form-group">
                        <label class="form-label">THC %</label>
                        <input type="number" class="form-input" id="thc" placeholder="24.5" step="0.1" max="50">
                    </div>

                    <div class="form-group">
                        <label class="form-label">CBD %</label>
                        <input type="number" class="form-input" id="cbd" placeholder="1.2" step="0.1" max="50">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Lab Certification ID</label>
                        <input type="text" class="form-input" id="labId" placeholder="LAB-2024-001" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Cultivator License</label>
                        <input type="text" class="form-input" id="cultivator" placeholder="License #12345" required>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        Mint Authentication NFT (0.5 TON)
                    </button>
                </form>
            </div>

            <div class="loading" id="mintLoading">
                <div class="spinner"></div>
                <p>Minting NFT on TON blockchain...</p>
            </div>
        </div>

        <!-- Premium Tab -->
        <div id="premium" class="tab-content">
            <div class="subscription-status" id="subscriptionStatus">
                <h3>Current Plan: <span id="currentPlan">FREE</span></h3>
                <p id="planDetails">3 verifications remaining this month</p>
            </div>

            <!-- Basic Plan -->
            <div class="pricing-card">
                <h3>Basic Plan</h3>
                <div class="price">$9.99<span class="price-period">/month</span></div>
                <ul class="features-list">
                    <li>Unlimited strain verifications</li>
                    <li>Basic lab results</li>
                    <li>QR code generation</li>
                    <li>Email support</li>
                </ul>
                <button class="btn btn-primary" onclick="subscribeToPlan('basic', 9.99)">
                    Subscribe to Basic
                </button>
            </div>

            <!-- Premium Plan -->
            <div class="pricing-card featured">
                <h3>Premium Plan ‚≠ê</h3>
                <div class="price premium">$29.99<span class="price-period">/month</span></div>
                <ul class="features-list">
                    <li>Everything in Basic</li>
                    <li>Advanced terpene analysis</li>
                    <li>Effects predictions</li>
                    <li>Market price tracking</li>
                    <li>Similar strain recommendations</li>
                    <li>Priority support</li>
                </ul>
                <button class="btn btn-premium" onclick="subscribeToPlan('premium', 29.99)">
                    Subscribe to Premium
                </button>
            </div>

            <!-- VIP Plan -->
            <div class="pricing-card">
                <h3>VIP Plan</h3>
                <div class="price">$99.99<span class="price-period">/month</span></div>
                <ul class="features-list">
                    <li>Everything in Premium</li>
                    <li>White-label solutions</li>
                    <li>API access</li>
                    <li>Custom branding</li>
                    <li>Dedicated account manager</li>
                    <li>Advanced analytics</li>
                </ul>
                <button class="btn btn-primary" onclick="subscribeToPlan('vip', 99.99)">
                    Subscribe to VIP
                </button>
            </div>
        </div>

        <!-- Earn Tab -->
        <div id="earn" class="tab-content">
            <div class="earnings-display">
                <div class="earnings-amount" id="totalEarnings">0.00 TON</div>
                <p>Total Earnings</p>
                <button class="btn btn-premium" onclick="withdrawEarnings()">
                    Withdraw Earnings
                </button>
            </div>

            <h3>üí∞ Ways to Earn TON</h3>

            <!-- Referral Program -->
            <div class="feature-card">
                <h4>üîó Referral Program</h4>
                <p>Earn 0.1 TON for each friend who joins + 10% of their subscription fees</p>
                <div class="referral-code" id="referralCode">REF-ABC123</div>
                <button class="btn btn-secondary" onclick="shareReferralCode()">
                    Share Referral Link
                </button>
            </div>

            <!-- Daily Challenges -->
            <div class="feature-card">
                <h4>üéØ Daily Challenges</h4>
                <div style="margin: 10px 0;">
                    <p>‚úÖ Verify 3 strains today (+0.01 TON) - Complete!</p>
                    <p>‚è≥ Share app with friend (+0.05 TON) - In Progress</p>
                    <p>‚ùå Write strain review (+0.02 TON) - Pending</p>
                </div>
                <button class="btn btn-primary" onclick="completeChallenge()">
                    Complete Next Challenge
                </button>
            </div>

            <!-- Verification Rewards -->
            <div class="feature-card">
                <h4>üèÜ Verification Milestones</h4>
                <p>Earn TON rewards for verification milestones:</p>
                <ul class="features-list" style="text-align: left; margin: 10px 0;">
                    <li>10 verifications: 0.1 TON</li>
                    <li>50 verifications: 0.5 TON</li>
                    <li>100 verifications: 1.0 TON</li>
                    <li>500 verifications: 5.0 TON</li>
                </ul>
                <p>Current progress: <span id="verificationProgress">0/10</span></p>
            </div>

            <!-- Staking Rewards -->
            <div class="feature-card">
                <h4>üíé Stake NFTs for Rewards</h4>
                <p>Stake your StrainChain NFTs to earn 5% APY in TON tokens</p>
                <button class="btn btn-secondary" onclick="openStaking()">
                    View Staking Pool
                </button>
            </div>
        </div>

        <!-- Gallery Tab -->
        <div id="gallery" class="tab-content">
            <div class="success-message" id="gallerySuccess"></div>
            <div class="error-message" id="galleryError"></div>

            <!-- Featured Collection Banner -->
            <div class="featured-collection" style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 237, 78, 0.1)); border: 1px solid #ffd700; border-radius: 12px; padding: 20px; margin-bottom: 20px; text-align: center;">
                <h2>üî• Vintage Package Art NFTs</h2>
                <p>Own a piece of cannabis history</p>
                <div class="collection-stats" style="display: flex; justify-content: space-around; margin-top: 10px; font-size: 12px;">
                    <span>üìä <span id="totalOwners">2,847</span> Owners</span>
                    <span>üíé 0.5-200 TON</span>
                    <span>üéØ <span id="soldPercentage">87</span>% Sold</span>
                </div>
                <button class="btn btn-premium" onclick="showSubmissionForm()" style="margin-top: 15px;">
                    Submit Your Vintage Art
                </button>
            </div>

            <!-- Filter Controls -->
            <div class="filter-controls" style="display: flex; gap: 10px; margin-bottom: 15px; overflow-x: auto;">
                <select id="eraFilter" class="form-input" style="flex: 1; min-width: 120px;" onchange="filterNFTs()">
                    <option value="all">All Eras</option>
                    <option value="1970s">1970s Psychedelic</option>
                    <option value="1980s">1980s Underground</option>
                    <option value="1990s">1990s Street Art</option>
                    <option value="2000s">2000s Medical</option>
                    <option value="2010s">2010s Craft</option>
                </select>
                
                <select id="priceFilter" class="form-input" style="flex: 1; min-width: 100px;" onchange="filterNFTs()">
                    <option value="all">All Prices</option>
                    <option value="0.5-2">0.5-2 TON</option>
                    <option value="2-10">2-10 TON</option>
                    <option value="10-50">10-50 TON</option>
                    <option value="50+">50+ TON</option>
                </select>

                <select id="typeFilter" class="form-input" style="flex: 1; min-width: 100px;" onchange="filterNFTs()">
                    <option value="all">All Types</option>
                    <option value="static">Static Art</option>
                    <option value="animated">Animated</option>
                    <option value="interactive">Interactive</option>
                    <option value="commercial">Commercial Rights</option>
                </select>
            </div>

            <!-- NFT Grid -->
            <div class="nft-grid" id="nftGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                <!-- Sample NFTs will be populated here -->
            </div>

            <!-- Load More Button -->
            <button class="btn btn-secondary" onclick="loadMoreNFTs()" id="loadMoreBtn" style="margin-top: 20px;">
                Load More Vintage Art
            </button>

            <!-- Package Art Submission Form (Hidden by default) -->
            <div id="submissionForm" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.9); z-index: 1000; padding: 20px; overflow-y: auto;">
                <div style="background: #1a2332; border-radius: 12px; padding: 20px; max-width: 400px; margin: 0 auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>üì§ Submit Vintage Package Art</h3>
                        <button onclick="hideSubmissionForm()" style="background: none; border: none; color: #fff; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    
                    <div class="revenue-share" style="background: rgba(0, 212, 170, 0.1); border: 1px solid #00d4aa; border-radius: 8px; padding: 15px; margin-bottom: 20px; text-align: center;">
                        <p><strong>üí∞ Revenue Share: 70% You / 30% StrainChain</strong></p>
                        <p style="font-size: 12px; opacity: 0.8; margin-top: 5px;">Estimated value: $50-$500 per unique piece</p>
                    </div>
                    
                    <form id="artSubmissionForm">
                        <div class="form-group">
                            <label class="form-label">Package Image</label>
                            <input type="file" class="form-input" id="packageImage" accept="image/*" required>
                            <p style="font-size: 12px; opacity: 0.7; margin-top: 5px;">JPG, PNG, or HEIC. We'll enhance quality with AI.</p>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Strain Name (if known)</label>
                            <input type="text" class="form-input" id="strainName" placeholder="e.g., Purple Haze, Maui Wowie">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Approximate Year/Era</label>
                            <select class="form-input" id="artEra" required>
                                <option value="">Select Era</option>
                                <option value="1960s">1960s - Early Underground</option>
                                <option value="1970s">1970s - Psychedelic Era</option>
                                <option value="1980s">1980s - Reagan Years</option>
                                <option value="1990s">1990s - Grunge/Hip-Hop</option>
                                <option value="2000s">2000s - Medical Cannabis</option>
                                <option value="2010s">2010s - Craft Cannabis</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Story Behind This Package</label>
                            <textarea class="form-input" id="packageStory" rows="3" placeholder="Where did you get this? Any interesting history? Artist info?"></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Condition</label>
                            <select class="form-input" id="condition" required>
                                <option value="">Select Condition</option>
                                <option value="mint">Mint - Like new</option>
                                <option value="excellent">Excellent - Minor wear</option>
                                <option value="good">Good - Some wear/fading</option>
                                <option value="fair">Fair - Significant wear</option>
                                <option value="poor">Poor - Heavily damaged</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Contact Information</label>
                            <input type="text" class="form-input" id="contactInfo" placeholder="Telegram username or email" required>
                        </div>

                        <button type="submit" class="btn btn-premium">
                            Submit for Review & Valuation
                        </button>
                        
                        <p style="font-size: 12px; opacity: 0.7; margin-top: 10px; text-align: center;">
                            Review process: 24-48 hours. You'll receive valuation and revenue projection.
                        </p>
                    </form>
                </div>
            </div>
        </div>

        <!-- Business Tab (existing content) -->
        <div id="business" class="tab-content">
            <div class="business-cta">
                <h2>üè¢ Business Solutions</h2>
                <p>Professional cannabis authentication for dispensaries, cultivators, and labs</p>
            </div>

            <!-- Dispensary Package -->
            <div class="pricing-card">
                <h3>üè™ Dispensary Package</h3>
                <div class="price">$499<span class="price-period">/month</span></div>
                <ul class="features-list">
                    <li>100 strain authentications/month</li>
                    <li>Custom QR code generation</li>
                    <li>Customer verification portal</li>
                    <li>Basic analytics dashboard</li>
                    <li>Email support</li>
                </ul>
                <button class="btn btn-primary" onclick="contactSales('dispensary')">
                    Contact Sales
                </button>
            </div>

            <!-- Cultivator Package -->
            <div class="pricing-card featured">
                <h3>üå± Cultivator Package</h3>
                <div class="price premium">$299<span class="price-period">/month</span></div>
                <ul class="features-list">
                    <li>50 strain NFT mints/month</li>
                    <li>Lab integration</li>
                    <li>Batch authentication</li>
                    <li>Supply chain tracking</li>
                    <li>Phone support</li>
                </ul>
                <button class="btn btn-premium" onclick="contactSales('cultivator')">
                    Start Free Trial
                </button>
            </div>

            <!-- Lab Package -->
            <div class="pricing-card">
                <h3>üß™ Laboratory Package</h3>
                <div class="price">$199<span class="price-period">/month</span></div>
                <ul class="features-list">
                    <li>Unlimited verifications</li>
                    <li>API integration</li>
                    <li>White-label portal</li>
                    <li>Automated reporting</li>
                    <li>Priority support</li>
                </ul>
                <button class="btn btn-primary" onclick="contactSales('lab')">
                    Schedule Demo
                </button>
            </div>

            <!-- Enterprise -->
            <div class="feature-card">
                <h3>üè¢ Enterprise Solutions</h3>
                <p>Custom solutions for multi-state operators and large cannabis companies</p>
                <ul class="features-list">
                    <li>Custom development</li>
                    <li>Dedicated infrastructure</li>
                    <li>Advanced analytics</li>
                    <li>24/7 support</li>
                    <li>SLA guarantees</li>
                </ul>
                <button class="btn btn-premium" onclick="contactSales('enterprise')">
                    Contact Enterprise Sales
                </button>
            </div>
        </div>
    </div>

    <script>
        // Telegram WebApp initialization
        let tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
            tg.MainButton.setText("VERIFY STRAIN");
            tg.MainButton.show();
        }

        // App state
        let appState = {
            userPlan: 'free',
            verificationCount: 0,
            freeVerificationsLeft: 3,
            totalEarnings: 0,
            referralCode: 'REF-' + Math.random().toString(36).substr(2, 6).toUpperCase(),
            walletConnected: false,
            businessAccount: false
        };

        // Load user data from Telegram
        function initializeUser() {
            if (tg && tg.initDataUnsafe?.user) {
                const user = tg.initDataUnsafe.user;
                console.log('Telegram user:', user);
                
                // Load user preferences from server
                loadUserData(user.id);
            }
            
            updateUI();
        }

        async function loadUserData(userId) {
            try {
                // Simulate API call to load user data
                const userData = await fetch(`/api/user/${userId}`, {
                    headers: {
                        'X-Telegram-Init-Data': tg.initData
                    }
                });
                
                if (userData.ok) {
                    const data = await userData.json();
                    appState = { ...appState, ...data };
                }
            } catch (error) {
                console.log('Using default user data');
            }
        }

        function updateUI() {
            // Update header stats
            document.getElementById('userLevel').textContent = appState.userPlan.toUpperCase();
            document.getElementById('verificationCount').textContent = appState.verificationCount;
            document.getElementById('earningsCount').textContent = appState.totalEarnings.toFixed(2);
            
            // Update user badge
            if (appState.userPlan !== 'free') {
                document.getElementById('userBadge').style.display = 'inline-block';
                document.getElementById('userBadge').textContent = appState.userPlan.toUpperCase();
            }
            
            // Update free user limit warning
            if (appState.userPlan === 'free' && appState.freeVerificationsLeft <= 5) {
                document.getElementById('freeUserLimit').style.display = 'block';
                document.getElementById('freeUserLimit').innerHTML = 
                    `‚ö†Ô∏è Free plan: ${appState.freeVerificationsLeft} verifications remaining. Upgrade for unlimited!`;
            }
            
            // Update business features
            if (appState.businessAccount) {
                document.getElementById('businessRequired').style.display = 'none';
                document.getElementById('mintForm').style.display = 'block';
            }
            
            // Update subscription status
            updateSubscriptionStatus();
            
            // Update earnings
            document.getElementById('totalEarnings').textContent = appState.totalEarnings.toFixed(2) + ' TON';
            document.getElementById('referralCode').textContent = appState.referralCode;
            document.getElementById('verificationProgress').textContent = 
                `${appState.verificationCount}/10`;
        }

        function updateSubscriptionStatus() {
            const statusDiv = document.getElementById('subscriptionStatus');
            const currentPlan = document.getElementById('currentPlan');
            const planDetails = document.getElementById('planDetails');
            
            currentPlan.textContent = appState.userPlan.toUpperCase();
            
            if (appState.userPlan === 'free') {
                planDetails.textContent = `${appState.freeVerificationsLeft} verifications remaining this month`;
                statusDiv.style.background = 'rgba(239, 68, 68, 0.1)';
                statusDiv.style.borderColor = '#ef4444';
            } else {
                planDetails.textContent = 'Unlimited verifications ‚Ä¢ Premium features unlocked';
                statusDiv.style.background = 'rgba(0, 212, 170, 0.1)';
                statusDiv.style.borderColor = '#00d4aa';
            }
        }

        // Tab switching
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');

            // Update Telegram main button
            if (tg) {
                switch(tabName) {
                    case 'verify':
                        tg.MainButton.setText("SCAN QR CODE");
                        tg.MainButton.show();
                        break;
                    case 'mint':
                        tg.MainButton.setText(appState.businessAccount ? "MINT NFT" : "UPGRADE TO BUSINESS");
                        tg.MainButton.show();
                        break;
                    case 'premium':
                        tg.MainButton.setText("UPGRADE NOW");
                        tg.MainButton.show();
                        break;
                    case 'earn':
                        tg.MainButton.setText("COMPLETE CHALLENGE");
                        tg.MainButton.show();
                        break;
                    case 'business':
                        tg.MainButton.setText("CONTACT SALES");
                        tg.MainButton.show();
                        break;
                }
            }
        }

        // QR Code simulation
        function simulateQRScan() {
            if (appState.userPlan === 'free' && appState.freeVerificationsLeft <= 0) {
                showMessage('verifyError', 'Free verification limit reached. Upgrade to continue!');
                return;
            }

            const qrPlaceholder = document.getElementById('qrPlaceholder');
            qrPlaceholder.innerHTML = 'üîç';
            qrPlaceholder.style.borderColor = '#00d4aa';
            
            setTimeout(() => {
                document.getElementById('verificationCode').value = 'STRAIN-' + Math.random().toString(36).substr(2, 6).toUpperCase();
                verifyStrain();
                qrPlaceholder.innerHTML = 'üì±';
                qrPlaceholder.style.borderColor = 'rgba(255, 255, 255, 0.3)';
            }, 2000);
        }

        // Strain verification
        function verifyStrain() {
            const code = document.getElementById('verificationCode').value;
            
            if (!code) {
                showMessage('verifyError', 'Please enter a verification code or scan QR');
                return;
            }

            if (appState.userPlan === 'free' && appState.freeVerificationsLeft <= 0) {
                showMessage('verifyError', 'Free verification limit reached. Upgrade to continue!');
                return;
            }

            // Simulate verification
            setTimeout(() => {
                if (code.startsWith('STRAIN-')) {
                    // Successful verification
                    document.getElementById('verificationResult').style.display = 'block';
                    
                    // Show premium features for non-premium users
                    if (appState.userPlan === 'free' || appState.userPlan === 'basic') {
                        document.getElementById('premiumAnalysis').style.display = 'block';
                    } else {
                        document.getElementById('premiumAnalysis').style.display = 'none';
                    }
                    
                    // Update counters
                    appState.verificationCount++;
                    if (appState.userPlan === 'free') {
                        appState.freeVerificationsLeft--;
                    }
                    
                    // Award earnings
                    appState.totalEarnings += 0.001; // Small reward for verification
                    
                    updateUI();
                    showMessage('verifySuccess', '‚úÖ Strain verified successfully! +0.001 TON earned');
                    
                    // Send to Telegram
                    if (tg) {
                        tg.sendData(JSON.stringify({
                            action: 'strain_verified',
                            code: code,
                            earnings: 0.001
                        }));
                    }
                } else {
                    showMessage('verifyError', '‚ùå Invalid verification code or counterfeit product');
                }
            }, 1000);
        }

        // Subscription handling
        async function subscribeToPlan(plan, price) {
            if (!appState.walletConnected) {
                if (confirm('Connect TON wallet to subscribe?')) {
                    await connectWallet();
                }
                return;
            }

            try {
                showLoading('Loading payment...');
                
                // Simulate TON payment
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                appState.userPlan = plan;
                if (plan !== 'free') {
                    appState.freeVerificationsLeft = 999; // Unlimited
                }
                
                updateUI();
                showMessage('subscriptionSuccess', `Successfully subscribed to ${plan.toUpperCase()} plan!`);
                
                // Send to Telegram
                if (tg) {
                    tg.sendData(JSON.stringify({
                        action: 'subscription_purchased',
                        plan: plan,
                        price: price
                    }));
                }
                
                hideLoading();
                
            } catch (error) {
                showMessage('subscriptionError', 'Payment failed. Please try again.');
                hideLoading();
            }
        }

        // Referral system
        function shareReferralCode() {
            const referralLink = `https://t.me/strainchain_bot/app?ref=${appState.referralCode}`;
            
            if (tg) {
                tg.showPopup({
                    title: 'üîó Share StrainChain',
                    message: 'Earn 0.1 TON for each friend who joins!',
                    buttons: [
                        {
                            type: 'default',
                            text: 'Share Link'
                        },
                        {
                            type: 'cancel',
                            text: 'Cancel'
                        }
                    ]
                }, (buttonId) => {
                    if (buttonId === 'default') {
                        tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(referralLink)}&text=${encodeURIComponent('Check out StrainChain - Cannabis Authentication on TON blockchain! üåø')}`);
                    }
                });
            } else {
                // Fallback for non-Telegram environment
                navigator.clipboard.writeText(referralLink);
                showMessage('referralSuccess', 'Referral link copied to clipboard!');
            }
        }

        // Earnings and challenges
        function completeChallenge() {
            const challenges = [
                { name: 'Share with friend', reward: 0.05 },
                { name: 'Write strain review', reward: 0.02 },
                { name: 'Verify 5 strains', reward: 0.03 }
            ];
            
            const challenge = challenges[Math.floor(Math.random() * challenges.length)];
            appState.totalEarnings += challenge.reward;
            updateUI();
            
            showMessage('challengeSuccess', `Challenge "${challenge.name}" completed! +${challenge.reward} TON earned`);
        }

        function withdrawEarnings() {
            if (appState.totalEarnings < 0.1) {
                showMessage('withdrawError', 'Minimum withdrawal amount is 0.1 TON');
                return;
            }
            
            if (!appState.walletConnected) {
                showMessage('withdrawError', 'Please connect your TON wallet first');
                return;
            }
            
            // Simulate withdrawal
            showMessage('withdrawSuccess', `${appState.totalEarnings.toFixed(3)} TON sent to your wallet!`);
            appState.totalEarnings = 0;
            updateUI();
        }

        // Business features
        function contactSales(packageType) {
            if (tg) {
                tg.sendData(JSON.stringify({
                    action: 'contact_sales',
                    package: packageType,
                    userId: tg.initDataUnsafe?.user?.id
                }));
                
                showMessage('salesSuccess', 'Sales team will contact you within 24 hours!');
            }
        }

        // Wallet connection
        async function connectWallet() {
            try {
                // Simulate wallet connection
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                appState.walletConnected = true;
                showMessage('walletSuccess', 'TON wallet connected successfully!');
                
                return true;
            } catch (error) {
                showMessage('walletError', 'Failed to connect wallet');
                return false;
            }
        }

        // Utility functions
        function showMessage(type, message) {
            const element = document.createElement('div');
            element.className = type.includes('error') ? 'error-message' : 'success-message';
            element.textContent = message;
            element.style.display = 'block';
            
            // Insert at top of current tab
            const activeTab = document.querySelector('.tab-content.active');
            activeTab.insertBefore(element, activeTab.firstChild);
            
            setTimeout(() => {
                element.remove();
            }, 3000);
        }

        function showLoading(message) {
            // Implementation for loading state
            console.log('Loading:', message);
        }

        function hideLoading() {
            // Implementation for hiding loading state
            console.log('Loading complete');
        }

        // Telegram WebApp event handlers
        if (tg) {
            tg.onEvent('mainButtonClicked', function(){
                const activeTab = document.querySelector('.tab-content.active');
                
                switch(activeTab.id) {
                    case 'verify':
                        simulateQRScan();
                        break;
                    case 'mint':
                        if (!appState.businessAccount) {
                            switchTab('business');
                        } else {
                            // Mint NFT
                        }
                        break;
                    case 'premium':
                        subscribeToPlan('premium', 29.99);
                        break;
                    case 'earn':
                        completeChallenge();
                        break;
                    case 'business':
                        contactSales('dispensary');
                        break;
                }
            });

            // Handle theme
            tg.setHeaderColor('#0d1421');
            tg.setBackgroundColor('#0d1421');
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeUser();
            
            // Simulate some existing data for demo
            appState.verificationCount = 7;
            appState.totalEarnings = 0.156;
            updateUI();
        });

        // Handle form submissions
        document.getElementById('strainMintForm')?.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!appState.businessAccount) {
                showMessage('mintError', 'Business account required for minting');
                return;
            }
            
            const formData = new FormData(e.target);
            const strainData = Object.fromEntries(formData.entries());
            
            try {
                showLoading('Minting NFT on TON blockchain...');
                
                // Simulate blockchain minting
                await new Promise(resolve => setTimeout(resolve, 4000));
                
                showMessage('mintSuccess', 'NFT minted successfully! QR codes generated for packaging.');
                e.target.reset();
                
                if (tg) {
                    tg.sendData(JSON.stringify({
                        action: 'nft_minted',
                        data: strainData
                    }));
                }
                
            } catch (error) {
                showMessage('mintError', 'Failed to mint NFT. Please try again.');
            } finally {
                hideLoading();
            }
        });
    </script>
</body>
</html>